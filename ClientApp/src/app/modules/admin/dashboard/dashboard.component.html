<div class="flex flex-col flex-auto min-w-0">
    <div class="bg-card">
        <div class="flex flex-col w-full mx-auto px-6 sm:px-8">
            <div class="flex flex-col sm:flex-row flex-auto sm:items-center min-w-0 my-4 sm:my-6">
                <div class="flex flex-auto items-center min-w-0">
                    <div class="flex flex-col min-w-0 ml-4">
                        <div class="text-2xl md:text-5xl font-semibold tracking-tight leading-7 md:leading-snug truncate">Dashboard</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="flex-auto border-t -mt-px pt-4 sm:pt-6">
        <div class="w-full mx-auto">
            <mat-tab-group
                class="sm:px-2"
                [animationDuration]="'0'"
                [selectedIndex]="selectedTab">
                <mat-tab label="Home">
                    <ng-template matTabContent>
                        <div *ngIf="stats$ | async as stats; else loading">
                            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-9 xl:grid-cols-9 gap-10 w-full">
                                <div class="bg-gradient-to-r from-blue-500 to-blue-800 col-span-1 lg:col-span-2 flex flex-col flex-auto p-6 shadow rounded-2xl overflow-hidden card cursor-pointer hover:bg-gray-100" (click)="onDetail(tabType.Buildings)">
                                    <div class="flex items-start justify-between text-white">
                                        <div class="flex flex-col w-full gap-y-1">
                                            <div class="flex w-full justify-between">
                                                <div class="flex flex-col">
                                                    <div class="text-2xl font-medium tracking-normal leading-8 truncate">Buildings</div>
                                                    <div class="text-3xl font-semibold tracking-normal ">
                                                        {{stats.BuildingStats.NumberOfBuildings}}
                                                    </div>
                                                </div>
                                                <mat-icon class="icon-size-10" [svgIcon]="'feather:buildings'"></mat-icon>
                                            </div>
                                            <div class="flex flex-col w-full gap-y-1">
                                                <div class="flex w-full justify-between leading-4">
                                                    <span class="text-md">GLA</span>
                                                    <span class="text-lg font-semibold">{{stats.BuildingStats.TotalGLA | number : '1.0-2'}}</span>
                                                </div>
                                                <div class="flex w-full justify-between leading-4">
                                                    <span class="text-md">Meters</span>
                                                    <span class="text-lg font-semibold">{{stats.BuildingStats.TotalNumberOfMeters | number : '1.0-2'}}</span>
                                                </div>
                                            </div>
                                        </div>                                        
                                    </div>
                                </div>
                                <div class="bg-gradient-to-r from-amber-400 to-amber-500 col-span-1 lg:col-span-2 flex flex-col flex-auto p-6 shadow rounded-2xl overflow-hidden card cursor-pointer hover:bg-gray-100" (click)="onDetail(tabType.Shops)">
                                    <div class="flex items-start justify-between text-white">
                                        <div class="flex flex-col w-full gap-y-1">
                                            <div class="flex w-full justify-between">
                                                <div class="flex flex-col">
                                                    <div class="text-2xl font-medium tracking-normal leading-8 truncate">Shops</div>
                                                    <div class="text-3xl font-semibold tracking-normal ">
                                                        {{stats.ShopStats.NumberOfShops | number : '1.0-2'}}
                                                    </div>
                                                </div>
                                                <mat-icon class="icon-size-10" [svgIcon]="'feather:clients'"></mat-icon>
                                            </div>
                                            <div class="flex flex-col w-full gap-y-1">
                                                <div class="flex w-full justify-between leading-4">
                                                    <span class="text-md">Occupied</span>
                                                    <span class="text-lg font-semibold">{{stats.ShopStats.OccupiedPercentage | percent : '1.0-2'}}</span>
                                                </div>
                                                <div class="flex w-full justify-between leading-4">
                                                    <span class="text-md">Area</span>
                                                    <span class="text-lg font-semibold">{{stats.ShopStats.TotalArea | number : '1.0-2'}}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-gradient-to-r from-emerald-400 to-emerald-500 col-span-1 lg:col-span-2 flex flex-col flex-auto p-6 bg-card shadow rounded-2xl overflow-hidden card cursor-pointer hover:bg-gray-100" (click)="onDetail(tabType.Tenants)">
                                    <div class="flex items-start justify-between text-white">
                                        <div class="flex flex-col w-full gap-y-1">
                                            <div class="flex w-full justify-between">
                                                <div class="flex flex-col">
                                                    <div class="text-2xl font-medium tracking-normal leading-8 truncate">Tenants</div>
                                                    <div class="text-3xl font-semibold tracking-normal ">
                                                        {{stats.TenantStats.NumberOfTenants | number : '1.0-2'}}
                                                    </div>
                                                </div>
                                                <mat-icon class="icon-size-10 text-white" [svgIcon]="'feather:users'"></mat-icon>
                                            </div>
                                            <div class="flex flex-col w-full gap-y-1">
                                                <div class="flex w-full justify-between leading-4">
                                                    <span class="text-md">Occupied</span>
                                                    <span class="text-lg font-semibold">{{stats.TenantStats.OccupiedPercentage | percent : '1.0-2'}}</span>
                                                </div>
                                                <div class="flex w-full justify-between leading-4">
                                                    <span class="text-md">Recovered</span>
                                                    <span class="text-lg font-semibold">{{stats.TenantStats.RecoverablePercentage | percent : '1.0-2'}}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-gradient-to-r from-violet-400 to-violet-600 sm:col-span-3 flex flex-col flex-auto p-6 bg-card shadow rounded-2xl overflow-hidden card cursor-pointer hover:bg-gray-100" (click)="onDetail(tabType.Tenants)">
                                    <div class="flex items-start justify-between text-white">
                                        <div class="flex flex-col w-full gap-y-1">
                                            <div class="flex w-full justify-between">
                                                <div class="flex flex-col">
                                                    <div class="text-2xl font-medium tracking-normal leading-8 truncate">Smart Services</div>
                                                    <div class="text-3xl font-semibold tracking-normal ">
                                                        {{stats.SmartStats.TotalSmart | number : '1.0-2'}}
                                                    </div>
                                                </div>
                                                <mat-icon class="icon-size-10 text-white" [svgIcon]="'feather:users'"></mat-icon>
                                            </div>
                                            <div class="flex flex-col w-full gap-y-1">
                                                <div class="flex w-full gap-x-4">
                                                    <div class="flex justify-between w-1/2 leading-4">
                                                        <span class="text-md">Solar</span>
                                                        <span class="text-lg font-semibold">{{stats.SmartStats.SolarCount}}</span>
                                                    </div>
                                                    <div class="flex justify-between w-1/2 leading-4">
                                                        <span class="text-md">Generator</span>
                                                        <span class="text-lg font-semibold">{{stats.SmartStats.GeneratorCount}}</span>
                                                    </div>
                                                </div>
                                                <div class="flex w-full gap-x-4">
                                                    <div class="flex justify-between w-1/2 leading-4">
                                                        <span class="text-md">Electricity</span>
                                                        <span class="text-lg font-semibold">{{stats.SmartStats.ConsumerElectricityCount}}</span>
                                                    </div>
                                                    <div class="flex justify-between w-1/2 leading-4">
                                                        <span class="text-md">Water</span>
                                                        <span class="text-lg font-semibold">{{stats.SmartStats.ConsumerWaterCount}}</span>
                                                    </div>
                                                </div>
                                                <div class="flex w-full gap-x-4">
                                                    <div class="flex justify-between w-1/2 leading-4">
                                                        <span class="text-md">Bulk</span>
                                                        <span class="text-lg font-semibold">{{stats.SmartStats.BulkCount}}</span>
                                                    </div>
                                                    <div class="flex justify-between w-1/2 leading-4">
                                                        <span class="text-md">Council Check</span>
                                                        <span class="text-lg font-semibold">{{stats.SmartStats.CouncilChkCount}}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 lg:grid-cols-3 mt-3 gap-x-8 gap-y-2">
                                <div class="col-span-1">
                                    <div class="sm:col-span-2 flex flex-col flex-auto  bg-card shadow rounded-2xl overflow-visible">
                                        <div class="flex flex-col px-6 pt-6 gap-y-2">
                                            <div class="flex items-start justify-between">
                                                <div class="text-lg font-semibold tracking-tight leading-6 truncate">Electricity Usage - Last 6 Periods</div>
                                            </div>
                                            <div class="flex flex-col">
                                                <div class="text-3xl font-semibold tracking-tight leading-tight">
                                                    {{totalElectricityUsage | number : '1.0-2'}} <span class="text-xl">kwh</span>
                                                </div>
                                                <div class="flex items-center">
                                                    <mat-icon
                                                        class="mr-1 icon-size-5"
                                                        [ngClass]="{'text-green-500': varianceElectricity > 100, 'text-red-500': varianceElectricity < 100}"
                                                        [svgIcon]="varianceElectricity > 100 ? 'heroicons_solid:trending-up' : 'heroicons_solid:trending-down'"></mat-icon>
                                                    <div class="font-medium text-sm text-secondary leading-none whitespace-nowrap">
                                                        Variance for last period: <span class="text-pink-500">{{varianceElectricity | number : '1.0-2'}} %</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                            
                                        <div class="flex flex-col flex-auto w-full">
                                            <apx-chart
                                                class="flex-auto w-full h-24"
                                                [chart]="chartElectricityUsage.chart"
                                                [colors]="chartElectricityUsage.colors"
                                                [series]="chartElectricityUsage.series"
                                                [stroke]="chartElectricityUsage.stroke"
                                                [tooltip]="chartElectricityUsage.tooltip"
                                                [xaxis]="chartElectricityUsage.xaxis"
                                                [yaxis]="chartElectricityUsage.yaxis"></apx-chart>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-span-1">
                                    <div class="sm:col-span-2 flex flex-col flex-auto  bg-card shadow rounded-2xl overflow-visible">
                                        <div class="flex flex-col px-6 pt-6 gap-y-2">
                                            <div class="flex items-start justify-between">
                                                <div class="text-lg font-semibold tracking-tight leading-6 truncate">Water Usage - Last 6 Periods</div>
                                            </div>
                                            <div class="flex flex-col">
                                                <div class="text-3xl font-semibold tracking-tight leading-tight">
                                                    {{totalWaterUsage | number : '1.0-2'}} <span class="text-xl">KL</span>
                                                </div>
                                                <div class="flex items-center">
                                                    <mat-icon
                                                        class="mr-1 icon-size-5"
                                                        [ngClass]="{'text-green-500': varianceWater > 100, 'text-red-500': varianceWater < 100}"
                                                        [svgIcon]="varianceWater > 100 ? 'heroicons_solid:trending-up' : 'heroicons_solid:trending-down'"></mat-icon>
                                                    <div class="font-medium text-sm text-secondary leading-none whitespace-nowrap">
                                                        Variance for last period: <span class="text-blue-500">{{varianceWater | number : '1.0-2'}} %</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                            
                                        <div class="flex flex-col flex-auto w-full">
                                            <apx-chart
                                                class="flex-auto w-full h-24"
                                                [chart]="chartWaterUsage.chart"
                                                [colors]="chartWaterUsage.colors"
                                                [series]="chartWaterUsage.series"
                                                [stroke]="chartWaterUsage.stroke"
                                                [tooltip]="chartWaterUsage.tooltip"
                                                [xaxis]="chartWaterUsage.xaxis"
                                                [yaxis]="chartWaterUsage.yaxis"></apx-chart>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-span-1">
                                    <div class="sm:col-span-2 flex flex-col flex-auto  bg-card shadow rounded-2xl overflow-visible">
                                        <div class="flex flex-col px-6 pt-6 gap-y-2">
                                            <div class="flex items-start justify-between">
                                                <div class="text-lg font-semibold tracking-tight leading-6 truncate">Sales - Last 6 Periods</div>
                                            </div>
                                            <div class="flex flex-col">
                                                <div class="text-3xl font-semibold tracking-tight leading-tight">
                                                    R {{totalSales | number : '1.0-2'}}
                                                </div>
                                                <div class="flex items-center">
                                                    <mat-icon
                                                        class="mr-1 icon-size-5"
                                                        [ngClass]="{'text-green-500': varianceSales > 100, 'text-red-500': varianceSales < 100}"
                                                        [svgIcon]="varianceSales > 100 ? 'heroicons_solid:trending-up' : 'heroicons_solid:trending-down'"></mat-icon>
                                                    <div class="font-medium text-sm text-secondary leading-none whitespace-nowrap">
                                                        Variance for last period: <span class="text-emerald-500">{{varianceSales | number : '1.0-2'}} %</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                            
                                        <div class="flex flex-col flex-auto w-full">
                                            <apx-chart
                                                class="flex-auto w-full h-24"
                                                [chart]="chartSales.chart"
                                                [colors]="chartSales.colors"
                                                [series]="chartSales.series"
                                                [stroke]="chartSales.stroke"
                                                [tooltip]="chartSales.tooltip"
                                                [xaxis]="chartSales.xaxis"
                                                [yaxis]="chartSales.yaxis"></apx-chart>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 lg:grid-cols-2 mt-3">
                                <div class="col-span-1">
                                    <div class="bg-gradient-to-r from-gray-400 to-gray-600 sm:col-span-2 flex flex-col flex-auto shadow rounded-2xl overflow-visible text-white">
                                        <div class="flex flex-col p-6 gap-y-2">
                                            <div class="flex items-start justify-between">
                                                <div class="text-xl font-medium tracking-tight leading-6 truncate">CO<span class="leading-3 text-sm">2</span> Emissions based on above statistics</div>
                                            </div>
                                            <div class="flex justify-between gap-x-2">
                                                <div class="flex flex-col">
                                                    <div class="grid grid-cols-2 gap-1">
                                                        <div class="col-span-1"></div>
                                                        <div class="col-span-1">CO<span class="leading-3 text-sm">2</span> Tonnes</div>
                                                        <div class="col-span-1">Electricity</div>
                                                        <div class="col-span-1">{{totalElectricityUsage * 0.97 / 1000 | number : '1.0-2'}}</div>
                                                        <div class="col-span-1">Water</div>
                                                        <div class="col-span-1">{{totalWaterUsage * 0.298 / 1000 | number : '1.0-2'}}</div>
                                                    </div>
                                                </div>
                                                <div class="flex border-r w-1"></div>
                                                <div class="flex flex-col">
                                                    <div class="grid grid-cols-3 gap-1">
                                                        <div class="col-span-1">Trees</div>
                                                        <div class="col-span-1">Area-Hectare</div>
                                                        <div class="col-span-1">Rugby Fields</div>
                                                        <div class="col-span-1">{{totalElectricityUsage * 0.97 / 1000 * 1000 / 27 | number : '1.0-2'}}</div>
                                                        <div class="col-span-1">{{totalElectricityUsage * 0.97 / 1000 * 1000 / 27 / 400 | number : '1.0-2'}}</div>
                                                        <div class="col-span-1">{{totalElectricityUsage * 0.97 / 1000 * 1000 / 27 / 400 * 1000 / 12000 | number : '1.0-2'}}</div>
                                                        <div class="col-span-1">{{totalWaterUsage * 0.298 / 1000 * 1000 / 27 | number : '1.0-2'}}</div>
                                                        <div class="col-span-1">{{totalWaterUsage * 0.298 / 1000 * 1000 / 27 / 400 | number : '1.0-2'}}</div>
                                                        <div class="col-span-1">{{totalWaterUsage * 0.298 / 1000 * 1000 / 27 / 400 * 1000 / 12000 | number : '1.0-2'}}</div>
                                                    </div>
                                                    
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <ng-template #loading></ng-template>
                    </ng-template>
                </mat-tab>
                <ng-container *ngFor="let tabItem of tabsList; let i = index;">
                    <mat-tab class="home-tab" label="{{tabItem.title}}">
                        <ng-template mat-tab-label>
                            {{tabItem.title}}
                            <mat-icon class="icon-size-4 hover:text-red-500" [svgIcon]="'feather:x'" (click)="removeTab(i)"></mat-icon>
                          </ng-template>
                        <ng-template matTabContent>
                            <ng-container *ngIf="tabItem.dataSource">
                                <div class="flex gap-x-4">
                                    <div class="bg-card p-2">
                                        <dx-data-grid
                                            [dataSource]="tabItem.dataSource"
                                            [showBorders]="true"
                                            class="grid-container"
                                            (onRowPrepared)="onRowPrepared($event)"
                                        >
                                            <dxo-scrolling rowRenderingMode="virtual"> </dxo-scrolling>
                                            <dxo-paging [pageSize]="10"> </dxo-paging>
                                            <dxo-pager
                                                [visible]="true"
                                                [allowedPageSizes]="allowedPageSizes"
                                                [displayMode]="'compact'"
                                                [showPageSizeSelector]="true"
                                                [showInfo]="true"
                                                [showNavigationButtons]="true"
                                            >
                                            </dxo-pager>
                                            <dxo-search-panel
                                                [visible]="true"
                                                [width]="200"
                                                placeholder="Search..."
                                            ></dxo-search-panel>
                                            <dxi-column dataField="PartnerName" caption="Partner" ></dxi-column>
                                            <dxi-column dataField="BuildingName" caption="Building"></dxi-column>
                                        </dx-data-grid>
                                    </div>                                    
                                </div>
                            </ng-container>
                        </ng-template>
                    </mat-tab>
                </ng-container>
            </mat-tab-group>
        </div>
        

    </div>

</div>
